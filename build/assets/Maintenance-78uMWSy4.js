import{c as D,r as c,j as e,t as f,m as M}from"./index-mGwfGQYQ.js";import{D as R,a as _,b as P,c as A}from"./dialog-D60cBJNC.js";import{B as j}from"./button-obQTf0hL.js";import{f as C,b as B}from"./format-DtwxcAHJ.js";import{P as F}from"./plus-B5-QUGQk.js";import{T as k}from"./triangle-alert-MAIQVqwN.js";import{C as I}from"./clock-D2pz7tme.js";import{C as T}from"./circle-check-big-ByHU8OVq.js";import{W as S}from"./wrench-DnrUsuT8.js";import{S as $}from"./square-pen-CVcJ4uLN.js";import{c as E}from"./createLucideIcon-_jMiD3q_.js";import"./utils-Bp-GuQk1.js";import"./x-BRS87iRj.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],z=E("circle-x",O);function U({isOpen:o,onClose:u,ticketId:d}){const{maintenanceRequests:y,units:h,properties:x,addMaintenanceRequest:N,updateMaintenanceRequest:p}=D(),[l,r]=c.useState({propertyId:"",unitId:"",title:"",description:"",status:"new",priority:"medium",assignedTo:"",cost:0});c.useEffect(()=>{if(d){const t=y.find(n=>n.id===d);t&&r({propertyId:t.propertyId,unitId:t.unitId||"",title:t.title,description:t.description,status:t.status,priority:t.priority,assignedTo:t.assignedTo||"",cost:t.cost||0})}else r({propertyId:"",unitId:"",title:"",description:"",status:"new",priority:"medium",assignedTo:"",cost:0})},[d,y,o]);const g=t=>{r({...l,propertyId:t,unitId:""})},v=t=>h.filter(n=>n.propertyId===t),m=t=>x.find(n=>n.id===t)?.name||"",b=t=>h.find(n=>n.id===t)?.unitNo,w=t=>{if(t.preventDefault(),!l.propertyId||!l.title){f.error("الرجاء إدخال العقار وعنوان المشكلة");return}const n={propertyId:l.propertyId,propertyName:m(l.propertyId),unitId:l.unitId||void 0,unitNo:l.unitId?b(l.unitId):void 0,title:l.title,description:l.description,status:l.status,priority:l.priority,assignedTo:l.assignedTo||void 0,cost:l.cost,requestedBy:"admin"};d?(p(d,n),f.success("تم تحديث طلب الصيانة")):(N(n),f.success("تم إنشاء طلب الصيانة")),u()};return e.jsx(R,{open:o,onOpenChange:u,children:e.jsxs(_,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(P,{children:e.jsx(A,{children:d?"تعديل طلب الصيانة":"طلب صيانة جديد"})}),e.jsxs("form",{onSubmit:w,className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["العقار ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:l.propertyId,onChange:t=>g(t.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",children:[e.jsx("option",{value:"",children:"اختر العقار"}),x.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.city]},t.id))]})]}),l.propertyId&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوحدة (اختياري)"}),e.jsxs("select",{value:l.unitId,onChange:t=>r({...l,unitId:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",children:[e.jsx("option",{value:"",children:"صيانة عامة للعقار"}),v(l.propertyId).map(t=>e.jsx("option",{value:t.id,children:t.unitNo},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["عنوان المشكلة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:l.title,onChange:t=>r({...l,title:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue",placeholder:"مثال: تسريب في الحمام"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("textarea",{value:l.description,onChange:t=>r({...l,description:t.target.value}),rows:3,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue",placeholder:"وصف تفصيلي للمشكلة..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الأولوية"}),e.jsxs("select",{value:l.priority,onChange:t=>r({...l,priority:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",children:[e.jsx("option",{value:"low",children:"منخفض"}),e.jsx("option",{value:"medium",children:"متوسط"}),e.jsx("option",{value:"high",children:"مرتفع"}),e.jsx("option",{value:"urgent",children:"عاجل"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الحالة"}),e.jsxs("select",{value:l.status,onChange:t=>r({...l,status:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",children:[e.jsx("option",{value:"new",children:"جديد"}),e.jsx("option",{value:"in_progress",children:"قيد التنفيذ"}),e.jsx("option",{value:"done",children:"مكتمل"}),e.jsx("option",{value:"canceled",children:"ملغي"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المسؤول"}),e.jsx("input",{type:"text",value:l.assignedTo,onChange:t=>r({...l,assignedTo:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue",placeholder:"اسم الفني"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"التكلفة (ر.س)"}),e.jsx("input",{type:"number",min:"0",value:l.cost,onChange:t=>r({...l,cost:parseInt(t.target.value)||0}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(j,{type:"submit",variant:"gradient",className:"flex-1",children:d?"حفظ التعديلات":"إنشاء الطلب"}),e.jsx(j,{type:"button",variant:"outline",onClick:u,children:"إلغاء"})]})]})]})})}function se(){const{maintenanceRequests:o,updateMaintenanceRequest:u,deleteMaintenanceRequest:d,properties:y}=D(),[h,x]=c.useState(!1),[N,p]=c.useState(null),[l,r]=c.useState("all"),[g,v]=c.useState("all"),m=c.useMemo(()=>({new:o.filter(s=>s.status==="new").length,in_progress:o.filter(s=>s.status==="in_progress").length,done:o.filter(s=>s.status==="done").length,totalCost:o.reduce((s,a)=>s+a.cost,0)}),[o]),b=c.useMemo(()=>o.filter(s=>{const a=l==="all"||s.status===l,i=g==="all"||s.priority===g;return a&&i}).sort((s,a)=>{const i={urgent:0,high:1,medium:2,low:3};return i[s.priority]!==i[a.priority]?i[s.priority]-i[a.priority]:new Date(a.createdAt).getTime()-new Date(s.createdAt).getTime()}),[o,l,g]),w=(s,a)=>{u(s,{status:a}),f.success(a==="done"?"تم إتمام طلب الصيانة":"تم تحديث الحالة")},t=s=>{const i={urgent:{bg:"bg-red-100",text:"text-red-700",label:"عاجل"},high:{bg:"bg-orange-100",text:"text-orange-700",label:"مرتفع"},medium:{bg:"bg-amber-100",text:"text-amber-700",label:"متوسط"},low:{bg:"bg-gray-100",text:"text-gray-700",label:"منخفض"}}[s];return e.jsx("span",{className:`px-1.5 lg:px-2 py-0.5 lg:py-1 rounded-full text-[10px] lg:text-xs font-medium ${i.bg} ${i.text}`,children:i.label})},n=s=>({new:e.jsx(k,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-amber-500"}),in_progress:e.jsx(I,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-blue-500"}),done:e.jsx(T,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-green-500"}),canceled:e.jsx(z,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-gray-400"})})[s];return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm lg:text-base text-gray-600",children:["إدارة ومتابعة طلبات الصيانة (",o.length," طلب)"]})}),e.jsxs(j,{onClick:()=>{p(null),x(!0)},variant:"gradient",className:"w-full sm:w-auto text-sm lg:text-base",children:[e.jsx(F,{className:"w-4 h-4 lg:w-5 lg:h-5 ml-2"}),"طلب صيانة جديد"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 lg:gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(k,{className:"w-4 h-4 lg:w-5 lg:h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl lg:text-2xl font-bold text-brand-dark",children:m.new}),e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"جديدة"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(I,{className:"w-4 h-4 lg:w-5 lg:h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl lg:text-2xl font-bold text-brand-dark",children:m.in_progress}),e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"قيد التنفيذ"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(T,{className:"w-4 h-4 lg:w-5 lg:h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl lg:text-2xl font-bold text-brand-dark",children:m.done}),e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"مكتملة"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(S,{className:"w-4 h-4 lg:w-5 lg:h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm lg:text-lg font-bold text-brand-dark",children:C(m.totalCost)}),e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"إجمالي التكلفة"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-3 lg:p-4",children:e.jsxs("div",{className:"space-y-3 lg:space-y-0 lg:grid lg:grid-cols-2 lg:gap-4",children:[e.jsx("div",{className:"flex gap-1.5 lg:gap-2 overflow-x-auto pb-1",children:["all","new","in_progress","done"].map(s=>e.jsx("button",{onClick:()=>r(s),className:`flex-1 min-w-fit py-2 px-2 rounded-xl text-xs lg:text-sm font-medium transition-all whitespace-nowrap ${l===s?"bg-brand-blue text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s==="all"?"الكل":s==="new"?"جديدة":s==="in_progress"?"قيد التنفيذ":"مكتملة"},s))}),e.jsx("div",{className:"flex gap-1.5 lg:gap-2 overflow-x-auto pb-1",children:["all","urgent","high","medium","low"].map(s=>e.jsx("button",{onClick:()=>v(s),className:`flex-1 min-w-fit py-2 px-2 rounded-xl text-xs lg:text-sm font-medium transition-all whitespace-nowrap ${g===s?"bg-brand-dark text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s==="all"?"الأولويات":s==="urgent"?"عاجل":s==="high"?"مرتفع":s==="medium"?"متوسط":"منخفض"},s))})]})}),e.jsx("div",{className:"space-y-3 lg:space-y-4",children:b.map((s,a)=>e.jsx(M.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.03},className:`bg-white rounded-xl shadow-lg p-3 lg:p-5 border-r-4 ${s.priority==="urgent"?"border-red-500":s.priority==="high"?"border-orange-500":s.priority==="medium"?"border-amber-500":"border-gray-300"}`,children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-3 lg:gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3 mb-2",children:[n(s.status),e.jsx("h3",{className:"font-bold text-brand-dark text-sm lg:text-base",children:s.title}),t(s.priority)]}),e.jsx("p",{className:"text-xs lg:text-sm text-gray-500 mb-2 line-clamp-2",children:s.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 lg:gap-4 text-[10px] lg:text-xs text-gray-400",children:[e.jsx("span",{children:s.propertyName}),s.unitNo&&e.jsxs("span",{children:["• وحدة ",s.unitNo]}),e.jsxs("span",{children:["• ",B(s.createdAt)]}),s.assignedTo&&e.jsxs("span",{className:"hidden sm:inline",children:["• المسؤول: ",s.assignedTo]})]})]}),e.jsxs("div",{className:"flex items-center justify-between lg:justify-end gap-2 lg:gap-4 pt-3 lg:pt-0 border-t lg:border-0 border-gray-100",children:[s.cost>0&&e.jsxs("div",{className:"text-right lg:text-left",children:[e.jsx("p",{className:"text-[10px] lg:text-xs text-gray-400",children:"التكلفة"}),e.jsx("p",{className:"font-bold text-brand-dark text-sm lg:text-base",children:C(s.cost)})]}),e.jsxs("select",{value:s.status,onChange:i=>w(s.id,i.target.value),className:"text-xs lg:text-sm rounded-lg px-2 lg:px-3 py-1.5 lg:py-2 border border-gray-200 focus:outline-none focus:ring-2 focus:ring-brand-blue/20",children:[e.jsx("option",{value:"new",children:"جديد"}),e.jsx("option",{value:"in_progress",children:"قيد التنفيذ"}),e.jsx("option",{value:"done",children:"مكتمل"}),e.jsx("option",{value:"canceled",children:"ملغي"})]}),e.jsxs(j,{size:"sm",variant:"outline",onClick:()=>{p(s.id),x(!0)},className:"text-xs lg:text-sm px-2 lg:px-3",children:[e.jsx($,{className:"w-3 h-3 lg:w-4 lg:h-4 lg:ml-1"}),e.jsx("span",{className:"hidden lg:inline",children:"تعديل"})]})]})]})},s.id))}),b.length===0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 lg:p-12 text-center",children:[e.jsx(S,{className:"w-10 h-10 lg:w-12 lg:h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-sm lg:text-base text-gray-500",children:"لا توجد طلبات صيانة"})]}),e.jsx(U,{isOpen:h,onClose:()=>{x(!1),p(null)},ticketId:N})]})}export{se as Maintenance};
