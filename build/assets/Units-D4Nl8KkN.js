import{c as E,r as x,j as e,t as b,d as L,m as A,L as D}from"./index-mGwfGQYQ.js";import{D as M,a as B,b as H,c as O}from"./dialog-D60cBJNC.js";import{B as C}from"./button-obQTf0hL.js";import{f as I}from"./format-DtwxcAHJ.js";import{P as R}from"./plus-B5-QUGQk.js";import{S as Y}from"./search-Sd1l6yxc.js";import{H as v}from"./house-JsTtFKRL.js";import{S as U}from"./square-pen-CVcJ4uLN.js";import{F as P}from"./file-text-1R6tpTFz.js";import{T}from"./trash-2-Duj4ao2x.js";import"./utils-Bp-GuQk1.js";import"./x-BRS87iRj.js";import"./createLucideIcon-_jMiD3q_.js";const _=[{value:"apartment",label:"شقة"},{value:"studio",label:"ستوديو"},{value:"office",label:"مكتب"},{value:"shop",label:"محل تجاري"},{value:"warehouse",label:"مستودع"},{value:"villa",label:"فيلا"}];function z({isOpen:d,onClose:u,propertyId:m,unitId:c}){const{units:j,properties:y,addUnit:n,updateUnit:i}=E(),[a,l]=x.useState({propertyId:m||"",unitNo:"",type:"apartment",floor:"",rentAmount:0,status:"vacant",areaSqm:0,bedrooms:0,bathrooms:0}),N=y.find(t=>t.id===a.propertyId);x.useEffect(()=>{if(c){const t=j.find(g=>g.id===c);t&&l({propertyId:t.propertyId,unitNo:t.unitNo,type:t.type,floor:t.floor||"",rentAmount:t.rentAmount,status:t.status,areaSqm:t.areaSqm||0,bedrooms:t.bedrooms||0,bathrooms:t.bathrooms||0})}else m&&l(t=>({...t,propertyId:m}))},[c,m,j,d]);const w=t=>{if(t.preventDefault(),!a.propertyId||!a.unitNo){b.error("الرجاء إدخال جميع الحقول المطلوبة");return}const g={propertyId:a.propertyId,propertyName:N?.name||"",unitNo:a.unitNo,type:a.type,floor:a.floor||void 0,rentAmount:a.rentAmount,status:a.status,areaSqm:a.areaSqm,bedrooms:a.bedrooms,bathrooms:a.bathrooms,images:[]};c?(i(c,g),b.success("تم تحديث الوحدة بنجاح")):(n(g),b.success("تم إضافة الوحدة بنجاح")),u()};return e.jsx(M,{open:d,onOpenChange:u,children:e.jsxs(B,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsx(O,{children:c?"تعديل الوحدة":"إضافة وحدة جديدة"})}),e.jsxs("form",{onSubmit:w,className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["العقار ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.propertyId,onChange:t=>l({...a,propertyId:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",disabled:!!m,children:[e.jsx("option",{value:"",children:"اختر العقار"}),y.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.city]},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["رقم الوحدة ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.unitNo,onChange:t=>l({...a,unitNo:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue",placeholder:"A-101"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["النوع ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:a.type,onChange:t=>l({...a,type:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",children:_.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الطابق"}),e.jsx("input",{type:"text",value:a.floor,onChange:t=>l({...a,floor:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue",placeholder:"الأول"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الحالة"}),e.jsxs("select",{value:a.status,onChange:t=>l({...a,status:t.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white",children:[e.jsx("option",{value:"vacant",children:"شاغرة"}),e.jsx("option",{value:"rented",children:"مؤجرة"}),e.jsx("option",{value:"maintenance",children:"صيانة"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["الإيجار (ر.س) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"0",value:a.rentAmount,onChange:t=>l({...a,rentAmount:parseInt(t.target.value)||0}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"المساحة (م²)"}),e.jsx("input",{type:"number",min:"0",value:a.areaSqm,onChange:t=>l({...a,areaSqm:parseInt(t.target.value)||0}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"غرف النوم"}),e.jsx("input",{type:"number",min:"0",value:a.bedrooms,onChange:t=>l({...a,bedrooms:parseInt(t.target.value)||0}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"دورات المياه"}),e.jsx("input",{type:"number",min:"0",value:a.bathrooms,onChange:t=>l({...a,bathrooms:parseInt(t.target.value)||0}),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(C,{type:"submit",variant:"gradient",className:"flex-1",children:c?"حفظ التعديلات":"إضافة الوحدة"}),e.jsx(C,{type:"button",variant:"outline",onClick:u,children:"إلغاء"})]})]})]})})}function le(){const{units:d,properties:u,contracts:m,deleteUnit:c,updateUnit:j}=E(),[y]=L(),n=y.get("property")||"all",[i,a]=x.useState(""),[l,N]=x.useState("all"),[w,t]=x.useState(!1),[g,S]=x.useState(null),p=x.useMemo(()=>d.filter(s=>{const r=s.unitNo.toLowerCase().includes(i.toLowerCase())||s.propertyName.toLowerCase().includes(i.toLowerCase()),o=l==="all"||s.status===l,h=n==="all"||s.propertyId===n;return r&&o&&h}),[d,i,l,n]),f=x.useMemo(()=>{const s=n==="all"?d:d.filter(r=>r.propertyId===n);return{total:s.length,rented:s.filter(r=>r.status==="rented").length,vacant:s.filter(r=>r.status==="vacant").length,maintenance:s.filter(r=>r.status==="maintenance").length}},[d,n]),k=s=>{S(s),t(!0)},$=s=>{const r=d.find(h=>h.id===s);if(m.some(h=>h.unitId===s&&h.status==="active")){b.error(`لا يمكن حذف الوحدة "${r?.unitNo}" لأنها مرتبطة بعقد نشط`);return}confirm(`هل أنت متأكد من حذف الوحدة "${r?.unitNo}"؟`)&&(c(s),b.success("تم حذف الوحدة بنجاح"))},q=(s,r)=>{j(s,{status:r}),b.success("تم تحديث حالة الوحدة")},F=s=>{const o={rented:{bg:"bg-green-100",text:"text-green-700",label:"مؤجرة"},vacant:{bg:"bg-amber-100",text:"text-amber-700",label:"شاغرة"},maintenance:{bg:"bg-red-100",text:"text-red-700",label:"صيانة"}}[s];return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${o.bg} ${o.text}`,children:o.label})};return u.find(s=>s.id===n),e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm lg:text-base text-gray-600",children:["إدارة الوحدات السكنية (",p.length," من ",f.total,")"]})}),e.jsxs(C,{onClick:()=>{S(null),t(!0)},variant:"gradient",className:"w-full sm:w-auto text-sm lg:text-base",children:[e.jsx(R,{className:"w-4 h-4 lg:w-5 lg:h-5 ml-2"}),"إضافة وحدة جديدة"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 lg:gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4 text-center",children:[e.jsx("div",{className:"text-xl lg:text-2xl font-bold text-brand-dark",children:f.total}),e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"إجمالي الوحدات"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4 text-center",children:[e.jsx("div",{className:"text-xl lg:text-2xl font-bold text-green-600",children:f.rented}),e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"مؤجرة"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4 text-center",children:[e.jsx("div",{className:"text-xl lg:text-2xl font-bold text-amber-600",children:f.vacant}),e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"شاغرة"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4 text-center",children:[e.jsx("div",{className:"text-xl lg:text-2xl font-bold text-red-600",children:f.maintenance}),e.jsx("div",{className:"text-xs lg:text-sm text-gray-500",children:"صيانة"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-3 lg:p-4",children:e.jsxs("div",{className:"space-y-3 lg:space-y-0 lg:grid lg:grid-cols-3 lg:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("input",{type:"text",placeholder:"البحث عن وحدة...",value:i,onChange:s=>a(s.target.value),className:"w-full pr-9 lg:pr-10 pl-3 lg:pl-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base"})]}),e.jsxs("select",{value:n,onChange:s=>window.location.href=`/app/units?property=${s.target.value}`,className:"w-full px-3 lg:px-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue bg-white text-sm lg:text-base",children:[e.jsx("option",{value:"all",children:"جميع العقارات"}),u.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("div",{className:"flex gap-1.5 lg:gap-2 overflow-x-auto pb-1",children:["all","vacant","rented","maintenance"].map(s=>e.jsx("button",{onClick:()=>N(s),className:`flex-1 min-w-fit py-2 px-2 lg:px-3 rounded-xl text-xs lg:text-sm font-medium transition-all whitespace-nowrap ${l===s?"bg-brand-blue text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s==="all"?"الكل":s==="vacant"?"شاغرة":s==="rented"?"مؤجرة":"صيانة"},s))})]})}),e.jsx("div",{className:"lg:hidden space-y-3",children:p.map((s,r)=>e.jsxs(A.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.02},className:"bg-white rounded-xl shadow p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-light flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-gray-900",children:s.unitNo}),s.floor&&e.jsxs("span",{className:"text-xs text-gray-400 block",children:["الطابق ",s.floor]})]})]}),F(s.status)]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"العقار:"}),e.jsx("span",{className:"text-gray-700",children:s.propertyName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"التفاصيل:"}),e.jsxs("span",{className:"text-gray-700",children:[s.bedrooms&&`${s.bedrooms} غرف`,s.bathrooms&&` • ${s.bathrooms} حمام`,s.areaSqm&&` • ${s.areaSqm} م²`]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"الإيجار:"}),e.jsx("span",{className:"font-bold text-brand-dark",children:I(s.rentAmount)})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-3 border-t border-gray-100",children:[e.jsxs("select",{value:s.status,onChange:o=>q(s.id,o.target.value),className:`text-xs font-medium rounded-lg px-2 py-1.5 border-0 ${s.status==="rented"?"bg-green-100 text-green-700":s.status==="vacant"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:[e.jsx("option",{value:"vacant",children:"شاغرة"}),e.jsx("option",{value:"rented",children:"مؤجرة"}),e.jsx("option",{value:"maintenance",children:"صيانة"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>k(s.id),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-brand-blue/10 rounded-lg transition-colors",title:"تعديل",children:e.jsx(U,{className:"w-4 h-4"})}),s.status==="vacant"&&e.jsx(D,{to:`/app/contracts?unit=${s.id}`,children:e.jsx("button",{className:"p-2 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"إنشاء عقد",children:e.jsx(P,{className:"w-4 h-4"})})}),e.jsx("button",{onClick:()=>$(s.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"حذف",children:e.jsx(T,{className:"w-4 h-4"})})]})]})]},s.id))}),e.jsxs("div",{className:"hidden lg:block bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"رقم الوحدة"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"العقار"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"التفاصيل"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"الإيجار"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"الحالة"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"الإجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map((s,r)=>e.jsxs(A.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.02},className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-brand-light flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-brand-blue"})}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-gray-900",children:s.unitNo}),s.floor&&e.jsxs("span",{className:"text-xs text-gray-400 block",children:["الطابق ",s.floor]})]})]})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:s.propertyName}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:e.jsxs("div",{className:"text-sm",children:[s.bedrooms&&e.jsxs("span",{children:[s.bedrooms," غرف"]}),s.bathrooms&&e.jsxs("span",{className:"mr-2",children:["• ",s.bathrooms," حمام"]}),s.areaSqm&&e.jsxs("span",{className:"mr-2",children:["• ",s.areaSqm," م²"]})]})}),e.jsx("td",{className:"px-6 py-4 font-bold text-brand-dark",children:I(s.rentAmount)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.status,onChange:o=>q(s.id,o.target.value),className:`text-xs font-medium rounded-lg px-2 py-1 border-0 ${s.status==="rented"?"bg-green-100 text-green-700":s.status==="vacant"?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700"}`,children:[e.jsx("option",{value:"vacant",children:"شاغرة"}),e.jsx("option",{value:"rented",children:"مؤجرة"}),e.jsx("option",{value:"maintenance",children:"صيانة"})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>k(s.id),className:"p-2 text-gray-400 hover:text-brand-blue hover:bg-brand-blue/10 rounded-lg transition-colors",title:"تعديل",children:e.jsx(U,{className:"w-4 h-4"})}),s.status==="vacant"&&e.jsx(D,{to:`/app/contracts?unit=${s.id}`,children:e.jsx("button",{className:"p-2 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"إنشاء عقد",children:e.jsx(P,{className:"w-4 h-4"})})}),e.jsx("button",{onClick:()=>$(s.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"حذف",children:e.jsx(T,{className:"w-4 h-4"})})]})})]},s.id))})]})}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد وحدات"}),(i||l!=="all")&&e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"جرب تغيير معايير البحث"})]})]}),p.length===0&&e.jsxs("div",{className:"lg:hidden text-center py-12 bg-white rounded-xl shadow",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-gray-500",children:"لا توجد وحدات"}),(i||l!=="all")&&e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"جرب تغيير معايير البحث"})]}),e.jsx(z,{isOpen:w,onClose:()=>{t(!1),S(null)},propertyId:n!=="all"?n:"",unitId:g})]})}export{le as Units};
