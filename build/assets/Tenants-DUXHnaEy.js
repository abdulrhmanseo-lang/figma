import{c as P,r as m,j as e,m as M,L,t as o}from"./index-mGwfGQYQ.js";import{B as d}from"./button-obQTf0hL.js";import{D as O,a as E,b as F,c as $}from"./dialog-D60cBJNC.js";import{P as N}from"./plus-B5-QUGQk.js";import{S as A}from"./search-Sd1l6yxc.js";import{P as B}from"./phone-D3Iy-cXP.js";import{M as U}from"./mail-8iv_-hcW.js";import{S as q}from"./square-pen-CVcJ4uLN.js";import{T as z}from"./trash-2-Duj4ao2x.js";import{F as H}from"./file-text-1R6tpTFz.js";import{U as R}from"./user-CZWyWh29.js";import"./utils-Bp-GuQk1.js";import"./x-BRS87iRj.js";import"./createLucideIcon-_jMiD3q_.js";function ne(){const{tenants:h,contracts:y,payments:v,addTenant:w,updateTenant:C,deleteTenant:k}=P(),[a,X]=m.useState(""),[T,c]=m.useState(!1),[x,g]=m.useState(null),[t,r]=m.useState({fullName:"",phone:"",email:"",nationalId:""}),b=h.filter(s=>s.fullName.toLowerCase().includes(a.toLowerCase())||s.phone.includes(a)||s.nationalId&&s.nationalId.includes(a)),f=s=>{const n=y.filter(l=>l.tenantId===s),i=n.filter(l=>l.status==="active"),j=v.filter(l=>n.some(p=>p.id===l.contractId)).filter(l=>l.status==="overdue"),D=j.reduce((l,p)=>l+p.amount,0);return{activeContracts:i.length,totalContracts:n.length,overdueCount:j.length,overdueAmount:D}},u=s=>{s?(g(s),r({fullName:s.fullName,phone:s.phone,email:s.email||"",nationalId:s.nationalId||""})):(g(null),r({fullName:"",phone:"",email:"",nationalId:""})),c(!0)},I=s=>{if(s.preventDefault(),!t.fullName||!t.phone){o.error("الرجاء إدخال الاسم ورقم الهاتف");return}x?(C(x.id,t),o.success("تم تحديث بيانات المستأجر")):(w(t),o.success("تم إضافة المستأجر بنجاح")),c(!1),g(null)},S=s=>{if(f(s.id).activeContracts>0){o.error(`لا يمكن حذف "${s.fullName}" لأنه لديه عقود نشطة`);return}confirm(`هل أنت متأكد من حذف "${s.fullName}"؟`)&&(k(s.id),o.success("تم حذف المستأجر بنجاح"))};return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm lg:text-base text-gray-600",children:["إدارة بيانات المستأجرين (",h.length," مستأجر)"]})}),e.jsxs(d,{onClick:()=>u(),variant:"gradient",className:"w-full sm:w-auto text-sm lg:text-base",children:[e.jsx(N,{className:"w-4 h-4 lg:w-5 lg:h-5 ml-2"}),"إضافة مستأجر جديد"]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-3 lg:p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("input",{type:"text",placeholder:"البحث بالاسم أو رقم الهاتف أو الهوية...",value:a,onChange:s=>X(s.target.value),className:"w-full pr-9 lg:pr-10 pl-3 lg:pl-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue transition-all text-sm lg:text-base"})]})}),b.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6",children:b.map((s,n)=>{const i=f(s.id);return e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.05},className:"bg-white rounded-xl lg:rounded-2xl shadow-lg p-4 lg:p-6 hover:shadow-xl transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3 lg:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-10 h-10 lg:w-12 lg:h-12 rounded-full bg-gradient-to-br from-brand-blue to-brand-purple flex items-center justify-center text-white font-bold text-base lg:text-lg",children:s.fullName.charAt(0)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-bold text-brand-dark text-sm lg:text-base truncate",children:s.fullName}),s.nationalId&&e.jsxs("p",{className:"text-[10px] lg:text-xs text-gray-400",children:["الهوية: ",s.nationalId]})]})]}),i.overdueCount>0&&e.jsxs("span",{className:"px-1.5 lg:px-2 py-0.5 lg:py-1 bg-red-100 text-red-600 text-[10px] lg:text-xs font-medium rounded-full flex-shrink-0",children:[i.overdueCount," متأخرة"]})]}),e.jsxs("div",{className:"space-y-1.5 lg:space-y-2 mb-3 lg:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs lg:text-sm text-gray-600",children:[e.jsx(B,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{dir:"ltr",className:"truncate",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-xs lg:text-sm text-gray-600",children:[e.jsx(U,{className:"w-3.5 h-3.5 lg:w-4 lg:h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.email})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 lg:gap-3 mb-3 lg:mb-4 pt-3 lg:pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"text-center p-1.5 lg:p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-base lg:text-lg font-bold text-brand-dark",children:i.activeContracts}),e.jsx("div",{className:"text-[10px] lg:text-xs text-gray-500",children:"عقد نشط"})]}),e.jsxs("div",{className:"text-center p-1.5 lg:p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-base lg:text-lg font-bold text-brand-dark",children:i.totalContracts}),e.jsx("div",{className:"text-[10px] lg:text-xs text-gray-500",children:"إجمالي العقود"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 lg:pt-4 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>u(s),className:"p-1.5 lg:p-2 text-gray-400 hover:text-brand-blue hover:bg-brand-blue/10 rounded-lg transition-colors",title:"تعديل",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>S(s),className:"p-1.5 lg:p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"حذف",children:e.jsx(z,{className:"w-4 h-4"})})]}),e.jsx(L,{to:`/app/contracts?tenant=${s.id}`,children:e.jsxs(d,{variant:"outline",size:"sm",className:"text-xs lg:text-sm px-2 lg:px-3",children:[e.jsx(H,{className:"w-3 h-3 lg:w-4 lg:h-4 ml-1"}),"العقود"]})})]})]},s.id)})}):e.jsxs("div",{className:"bg-white rounded-xl lg:rounded-2xl shadow-lg p-8 lg:p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 lg:w-20 lg:h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(R,{className:"w-8 h-8 lg:w-10 lg:h-10 text-gray-400"})}),e.jsx("h3",{className:"text-lg lg:text-xl font-bold text-gray-700 mb-2",children:"لا يوجد مستأجرين"}),e.jsx("p",{className:"text-sm lg:text-base text-gray-500 mb-6",children:a?"لا توجد نتائج تطابق البحث":"ابدأ بإضافة مستأجرك الأول"}),!a&&e.jsxs(d,{onClick:()=>u(),variant:"gradient",children:[e.jsx(N,{className:"w-5 h-5 ml-2"}),"إضافة مستأجر جديد"]})]}),e.jsx(O,{open:T,onOpenChange:c,children:e.jsxs(E,{className:"max-w-[95vw] sm:max-w-md mx-auto",children:[e.jsx(F,{children:e.jsx($,{className:"text-base lg:text-lg",children:x?"تعديل بيانات المستأجر":"إضافة مستأجر جديد"})}),e.jsxs("form",{onSubmit:I,className:"space-y-3 lg:space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs lg:text-sm font-medium text-gray-700 mb-1",children:["الاسم الكامل ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:t.fullName,onChange:s=>r({...t,fullName:s.target.value}),className:"w-full px-3 lg:px-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base",placeholder:"مثال: محمد أحمد السعيد"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs lg:text-sm font-medium text-gray-700 mb-1",children:["رقم الهاتف ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:t.phone,onChange:s=>r({...t,phone:s.target.value}),className:"w-full px-3 lg:px-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base",placeholder:"05XXXXXXXX",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs lg:text-sm font-medium text-gray-700 mb-1",children:"البريد الإلكتروني"}),e.jsx("input",{type:"email",value:t.email,onChange:s=>r({...t,email:s.target.value}),className:"w-full px-3 lg:px-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base",placeholder:"example@email.com",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs lg:text-sm font-medium text-gray-700 mb-1",children:"رقم الهوية الوطنية"}),e.jsx("input",{type:"text",value:t.nationalId,onChange:s=>r({...t,nationalId:s.target.value}),className:"w-full px-3 lg:px-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base",placeholder:"11XXXXXXXX",dir:"ltr"})]}),e.jsxs("div",{className:"flex gap-2 lg:gap-3 pt-4",children:[e.jsx(d,{type:"submit",variant:"gradient",className:"flex-1 text-sm lg:text-base py-2.5 lg:py-3",children:x?"حفظ التعديلات":"إضافة المستأجر"}),e.jsx(d,{type:"button",variant:"outline",onClick:()=>c(!1),className:"text-sm lg:text-base",children:"إلغاء"})]})]})]})})]})}export{ne as Tenants};
