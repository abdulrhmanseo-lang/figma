import{c as O,r,j as e,m as D,t as z}from"./index-mGwfGQYQ.js";import{B as p}from"./button-obQTf0hL.js";import{D as E,a as F,b as H,c as I}from"./dialog-D60cBJNC.js";import{f as n,a as b,d as c}from"./format-DtwxcAHJ.js";import{C as N}from"./circle-check-big-ByHU8OVq.js";import{C as S}from"./clock-D2pz7tme.js";import{T as P}from"./triangle-alert-MAIQVqwN.js";import{S as q}from"./search-Sd1l6yxc.js";import{C as $}from"./credit-card-1vICFsHR.js";import{R as M}from"./receipt-C_aSeEdx.js";import"./utils-Bp-GuQk1.js";import"./x-BRS87iRj.js";import"./createLucideIcon-_jMiD3q_.js";function te(){const{payments:i,recordPayment:A}=O(),[m,R]=r.useState(""),[g,T]=r.useState("all"),[d,f]=r.useState(null),[B,h]=r.useState(!1),[v,y]=r.useState("bank"),[w,j]=r.useState(""),u=r.useMemo(()=>i.filter(s=>{const a=s.tenantName.toLowerCase().includes(m.toLowerCase())||s.unitNo.toLowerCase().includes(m.toLowerCase()),t=g==="all"||s.status===g;return a&&t}).sort((s,a)=>{const t={overdue:0,due:1,paid:2};return t[s.status]!==t[a.status]?t[s.status]-t[a.status]:new Date(s.dueDate).getTime()-new Date(a.dueDate).getTime()}),[i,m,g]),x=r.useMemo(()=>{const s=i.filter(l=>l.status==="paid"),a=i.filter(l=>l.status==="due"),t=i.filter(l=>l.status==="overdue");return{paidCount:s.length,paidAmount:s.reduce((l,o)=>l+o.amount,0),dueCount:a.length,dueAmount:a.reduce((l,o)=>l+o.amount,0),overdueCount:t.length,overdueAmount:t.reduce((l,o)=>l+o.amount,0)}},[i]),L=()=>{d&&(A(d.id,v,w||void 0),z.success("تم تسجيل الدفعة بنجاح"),h(!1),f(null),j(""))},C=s=>{f(s),y("bank"),j(""),h(!0)},k=s=>{const t={paid:{bg:"bg-green-100",text:"text-green-700",label:"مدفوعة",icon:N},due:{bg:"bg-amber-100",text:"text-amber-700",label:"مستحقة",icon:S},overdue:{bg:"bg-red-100",text:"text-red-700",label:"متأخرة",icon:P}}[s];return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t.bg} ${t.text}`,children:[e.jsx(t.icon,{className:"w-3 h-3"}),t.label]})};return e.jsxs("div",{className:"space-y-4 lg:space-y-6",children:[e.jsx("div",{children:e.jsx("p",{className:"text-sm lg:text-base text-gray-600",children:"متابعة وتسجيل دفعات الإيجار"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 lg:gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(N,{className:"w-4 h-4 lg:w-5 lg:h-5 text-green-600"})}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"مدفوعة"}),e.jsx("p",{className:"text-sm lg:text-lg font-bold text-brand-dark",children:n(x.paidAmount)}),e.jsxs("p",{className:"text-[10px] lg:text-xs text-gray-400",children:[x.paidCount," دفعة"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(S,{className:"w-4 h-4 lg:w-5 lg:h-5 text-amber-600"})}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"مستحقة"}),e.jsx("p",{className:"text-sm lg:text-lg font-bold text-brand-dark",children:n(x.dueAmount)}),e.jsxs("p",{className:"text-[10px] lg:text-xs text-gray-400",children:[x.dueCount," دفعة"]})]})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow p-3 lg:p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-2 lg:gap-3",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(P,{className:"w-4 h-4 lg:w-5 lg:h-5 text-red-600"})}),e.jsxs("div",{className:"text-center sm:text-right",children:[e.jsx("p",{className:"text-xs lg:text-sm text-gray-500",children:"متأخرة"}),e.jsx("p",{className:"text-sm lg:text-lg font-bold text-red-600",children:n(x.overdueAmount)}),e.jsxs("p",{className:"text-[10px] lg:text-xs text-gray-400",children:[x.overdueCount," دفعة"]})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg p-3 lg:p-4",children:e.jsxs("div",{className:"space-y-3 lg:space-y-0 lg:grid lg:grid-cols-2 lg:gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4 lg:w-5 lg:h-5"}),e.jsx("input",{type:"text",placeholder:"البحث بالمستأجر أو الوحدة...",value:m,onChange:s=>R(s.target.value),className:"w-full pr-9 lg:pr-10 pl-3 lg:pl-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base"})]}),e.jsx("div",{className:"flex gap-1.5 lg:gap-2 overflow-x-auto pb-1",children:["all","overdue","due","paid"].map(s=>e.jsx("button",{onClick:()=>T(s),className:`flex-1 min-w-fit py-2 px-2 lg:px-3 rounded-xl text-xs lg:text-sm font-medium transition-all whitespace-nowrap ${g===s?"bg-brand-blue text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s==="all"?"الكل":s==="overdue"?"متأخرة":s==="due"?"مستحقة":"مدفوعة"},s))})]})}),e.jsx("div",{className:"lg:hidden space-y-3",children:u.slice(0,50).map((s,a)=>e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:a*.02},className:"bg-white rounded-xl shadow p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.tenantName}),e.jsx("p",{className:"text-xs text-gray-500",children:s.unitNo})]}),k(s.status)]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"المبلغ"}),e.jsx("p",{className:"font-bold text-brand-dark",children:n(s.amount)})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"تاريخ الاستحقاق"}),e.jsx("p",{className:"text-sm text-gray-600",children:b(s.dueDate)}),s.status!=="paid"&&e.jsx("span",{className:`text-[10px] ${s.status==="overdue"?"text-red-500":"text-amber-500"}`,children:c(s.dueDate)<0?`متأخرة ${Math.abs(c(s.dueDate))} يوم`:`بعد ${c(s.dueDate)} يوم`})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:s.status!=="paid"?e.jsxs(p,{size:"sm",variant:"gradient",onClick:()=>C(s),className:"w-full text-sm",children:[e.jsx($,{className:"w-4 h-4 ml-1"}),"تسجيل دفعة"]}):e.jsx("span",{className:"block text-center text-sm text-gray-400",children:s.method==="cash"?"نقداً":s.method==="bank"?"تحويل بنكي":"دفع إلكتروني"})})]},s.id))}),e.jsxs("div",{className:"hidden lg:block bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"المستأجر"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"الوحدة"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"المبلغ"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"تاريخ الاستحقاق"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"الحالة"}),e.jsx("th",{className:"px-6 py-4 text-right text-sm font-semibold text-gray-700",children:"الإجراء"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.slice(0,50).map((s,a)=>e.jsxs(D.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:a*.02},className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"font-medium text-gray-900",children:s.tenantName})}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:s.unitNo}),e.jsx("td",{className:"px-6 py-4 font-bold text-brand-dark",children:n(s.amount)}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:b(s.dueDate)}),s.status!=="paid"&&e.jsx("span",{className:`block text-xs ${s.status==="overdue"?"text-red-500":"text-amber-500"}`,children:c(s.dueDate)<0?`متأخرة ${Math.abs(c(s.dueDate))} يوم`:`بعد ${c(s.dueDate)} يوم`})]})}),e.jsx("td",{className:"px-6 py-4",children:k(s.status)}),e.jsx("td",{className:"px-6 py-4",children:s.status!=="paid"?e.jsxs(p,{size:"sm",variant:"gradient",onClick:()=>C(s),children:[e.jsx($,{className:"w-4 h-4 ml-1"}),"تسجيل دفعة"]}):e.jsx("span",{className:"text-sm text-gray-400",children:s.method==="cash"?"نقداً":s.method==="bank"?"تحويل بنكي":"دفع إلكتروني"})})]},s.id))})]})}),u.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"لا توجد دفعات تطابق البحث"})]})]}),u.length===0&&e.jsxs("div",{className:"lg:hidden text-center py-12 bg-white rounded-xl shadow text-gray-500",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"لا توجد دفعات تطابق البحث"})]}),e.jsx(E,{open:B,onOpenChange:h,children:e.jsxs(F,{className:"max-w-[95vw] sm:max-w-md mx-auto",children:[e.jsx(H,{children:e.jsx(I,{className:"text-base lg:text-lg",children:"تسجيل دفعة"})}),d&&e.jsxs("div",{className:"space-y-3 lg:space-y-4 mt-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-xl p-3 lg:p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 lg:gap-4 text-xs lg:text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"المستأجر:"}),e.jsx("p",{className:"font-medium",children:d.tenantName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"الوحدة:"}),e.jsx("p",{className:"font-medium",children:d.unitNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"المبلغ:"}),e.jsx("p",{className:"font-bold text-brand-dark",children:n(d.amount)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"تاريخ الاستحقاق:"}),e.jsx("p",{className:"font-medium",children:b(d.dueDate)})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs lg:text-sm font-medium text-gray-700 mb-2",children:"طريقة الدفع"}),e.jsx("div",{className:"grid grid-cols-3 gap-1.5 lg:gap-2",children:[{value:"bank",label:"تحويل بنكي"},{value:"cash",label:"نقداً"},{value:"online",label:"دفع إلكتروني"}].map(s=>e.jsx("button",{type:"button",onClick:()=>y(s.value),className:`py-2 px-2 lg:px-3 rounded-lg text-xs lg:text-sm font-medium transition-all ${v===s.value?"bg-brand-blue text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs lg:text-sm font-medium text-gray-700 mb-1",children:"رقم المرجع (اختياري)"}),e.jsx("input",{type:"text",value:w,onChange:s=>j(s.target.value),className:"w-full px-3 lg:px-4 py-2.5 lg:py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue text-sm lg:text-base",placeholder:"رقم الحوالة أو الإيصال",dir:"ltr"})]}),e.jsxs("div",{className:"flex gap-2 lg:gap-3 pt-4",children:[e.jsxs(p,{onClick:L,variant:"gradient",className:"flex-1 text-sm lg:text-base",children:[e.jsx(N,{className:"w-4 h-4 ml-2"}),"تأكيد الدفعة"]}),e.jsx(p,{variant:"outline",onClick:()=>h(!1),className:"text-sm lg:text-base",children:"إلغاء"})]})]})]})})]})}export{te as Payments};
